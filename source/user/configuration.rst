=============
Configuration
=============

Kurento works by orchestrating a broad set of technologies that must be made to work together. Some of these technologies can accept different configuration parameters that Kurento makes available through several configuration files:

* ``/etc/kurento/kurento.conf.json``

  The main configuration file. Provides settings for the behavior of Kurento Media Server itself.

* ``/etc/kurento/modules/kurento/MediaElement.conf.ini``

  Generic parameters for all kinds of *MediaElement*.

* ``/etc/kurento/modules/kurento/SdpEndpoint.conf.ini``

  Audio/video parameters for *SdpEndpoints* (i.e. *WebRtcEndpoint* and *RtpEndpoint*).

* ``/etc/kurento/modules/kurento/WebRtcEndpoint.conf.ini``

  Specific parameters for *WebRtcEndpoint*.

* ``/etc/kurento/modules/kurento/HttpEndpoint.conf.ini``

  Specific parameters for *HttpEndpoint*.

* ``/etc/default/kurento-media-server``

  This file is loaded by the system's service init files. Defines some environment variables, which have an effect on features such as the *Debug Logging*, or the *Core Dump* files that are generated when a crash happens.

For convenience, the :ref:`Kurento Docker <installation-docker>` also accepts some environment variables that map directly to settings in the above files. If this is not flexible enough, you can always use a `bind-mount <https://docs.docker.com/storage/bind-mounts/>`__ or `volume <https://docs.docker.com/storage/volumes/>`__ with a different set of configuration files in ``/etc/kurento/``. Of course, you can also base upon the Kurento Docker image and extend it to add your own configuration, modifications, or custom plugins, as desired.



Debug logging
-------------

KMS uses the environment variable ``GST_DEBUG`` to define the debug level of all underlying modules. Check :doc:`/features/logging` for more information about this and other environment variables.

Set this variable to change the verbosity level of the log messages generated by KMS.

**Local install**

* Set environment variable ``GST_DEBUG`` in ``/etc/default/kurento-media-server``.

**Docker**

* Pass environment variable ``GST_DEBUG``:

  .. code-block:: console

     docker run [...] \
         -e GST_DEBUG="Kurento*:5" \
         kurento/kurento-media-server:latest



STUN/TURN server
----------------

Read :ref:`faq-stun-needed` to learn about when you might need to use these, and :ref:`installation-stun-turn` for guidance on how to install your own STUN/TURN server.

**Local install**

* Set values ``stunServerAddress``, ``stunServerPort``, and ``turnURL`` in ``/etc/kurento/modules/kurento/WebRtcEndpoint.conf.ini``.

**Docker**

* Pass environment variables ``KMS_STUN_IP``, ``KMS_STUN_PORT``, ``KMS_TURN_URL``.

**Client API**

* Java: `setStunServerAddress <https://doc-kurento.readthedocs.io/en/latest/_static/client-javadoc/org/kurento/client/WebRtcEndpoint.html#setStunServerAddress-java.lang.String->`__, `setStunServerPort <https://doc-kurento.readthedocs.io/en/latest/_static/client-javadoc/org/kurento/client/WebRtcEndpoint.html#setStunServerPort-int->`__, `setTurnUrl <https://doc-kurento.readthedocs.io/en/latest/_static/client-javadoc/org/kurento/client/WebRtcEndpoint.html#setTurnUrl-java.lang.String->`__.
* JavaScript: `setStunServerAddress <https://doc-kurento.readthedocs.io/en/latest/_static/client-jsdoc/module-elements.WebRtcEndpoint.html#setStunServerAddress>`__, `setStunServerPort <https://doc-kurento.readthedocs.io/en/latest/_static/client-jsdoc/module-elements.WebRtcEndpoint.html#setStunServerPort>`__, `setTurnUrl <https://doc-kurento.readthedocs.io/en/latest/_static/client-jsdoc/module-elements.WebRtcEndpoint.html#setTurnUrl>`__.



Network interface
-----------------

To specify the network interface name(s) that KMS should use to communicate from the environment where it is running (either a physical machine, a virtual machine, a Docker container, etc.)

**Local install**

* Set value ``networkInterfaces`` in ``/etc/kurento/modules/kurento/WebRtcEndpoint.conf.ini``.

**Docker**

* Pass environment variable ``KMS_NETWORK_INTERFACES``.

**Client API**

* Java: `setNetworkInterfaces <https://doc-kurento.readthedocs.io/en/latest/_static/client-javadoc/org/kurento/client/WebRtcEndpoint.html#setNetworkInterfaces-java.lang.String->`__.
* JavaScript: `setNetworkInterfaces <https://doc-kurento.readthedocs.io/en/latest/_static/client-jsdoc/module-elements.WebRtcEndpoint.html#setNetworkInterfaces>`__.



RTP port
--------

You can configure the minimum and maximum ports that Kurento Media Server will open (bind to) in order to receive RTP packets from remote peers. This affects the operation of both RtpEndpoint and WebRtcEndpoint.

**Local install**

* Set values ``minPort``, ``maxPort`` in ``/etc/kurento/modules/kurento/BaseRtpEndpoint.conf.ini``.

**Docker**

* Pass environment variables ``KMS_MIN_PORT``, ``KMS_MAX_PORT``.



External IP address
-------------------

Only for advanced users who know what they are doing and why they need to set this. For most cases, it's better to leave this unset and use a STUN/TURN server instead.

When this feature is used, all of the Kurento IPv4 and/or IPv6 ICE candidates are mangled to contain the given address. This can speed up WebRTC connection establishment in scenarios where the external or public IP is already well known, also having the benefit that STUN won't be needed *for the media server*.

**Local install**

* Set values ``externalIPv4``, ``externalIPv6`` in ``/etc/kurento/modules/kurento/WebRtcEndpoint.conf.ini``.

**Docker**

* Pass environment variables ``KMS_EXTERNAL_IPV4``, ``KMS_EXTERNAL_IPV6``.
* If the special value ``auto`` is used, then the container will auto-discover its own public IP address by performing a DNS query to some of the well established providers (OpenDNS, Google, Cloudflare). You can review the script here: `getmyip.sh <https://github.com/Kurento/kurento-docker/blob/master/kurento-media-server/getmyip.sh>`__. In cases where these services are not reachable, the external IP parameters are left unset.

**Client API**

* Java: `setExternalIPv4 <https://doc-kurento.readthedocs.io/en/latest/_static/client-javadoc/org/kurento/client/WebRtcEndpoint.html#setExternalIPv4-java.lang.String->`__.
* JavaScript: `setExternalIPv4 <https://doc-kurento.readthedocs.io/en/latest/_static/client-jsdoc/module-elements.WebRtcEndpoint.html#setExternalIPv4>`__.



Maximum Transmission Unit
-------------------------

Only for advanced users who know what they are doing. For most cases, it's better to use the default MTU value of 1200 Bytes.

**Local install**

* Set value ``mtu`` in ``/etc/kurento/modules/kurento/BaseRtpEndpoint.conf.ini``.

**Docker**

* Pass environment variable ``KMS_MTU``.

**Client API**

* Java: `setMtu <https://doc-kurento.readthedocs.io/en/latest/_static/client-javadoc/org/kurento/client/BaseRtpEndpoint.html#setMtu-int->`__.
* JavaScript: `setMtu <https://doc-kurento.readthedocs.io/en/latest/_static/client-jsdoc/module-core_abstracts.BaseRtpEndpoint.html#setMtu>`__.
